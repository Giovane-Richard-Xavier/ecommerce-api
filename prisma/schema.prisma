generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String        @id @default(uuid())
  name      String
  email     String        @unique
  password  String
  addresses UserAddress[]
  orders    Order[]

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model UserAddress {
  id         String  @id @default(uuid())
  zipcode    String
  street     String
  number     String
  city       String
  country    String?
  complement String?

  user_id String
  user    User   @relation(fields: [user_id], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model Banner {
  id        String   @id @default(uuid())
  img       String
  link      String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model Product {
  id          String            @id @default(uuid())
  label       String
  price       Decimal           @db.Decimal(10, 2)
  description String?           @db.Text
  viewsCount  Int               @default(0)
  salesCount  Int               @default(0)
  images      ProductImage[]
  metadata    ProductMetadata[]

  category_id String
  categories  Category       @relation(fields: [category_id], references: [id])
  orders      OrderProduct[]

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model ProductImage {
  id         String  @id @default(uuid())
  url        String
  product_id String
  product    Product @relation(fields: [product_id], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model ProductMetadata {
  id                   String  @id @default(uuid())
  category_metadata_id String
  metadata_value_id    String
  product_id           String
  product              Product @relation(fields: [product_id], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model Category {
  id       String             @id @default(uuid())
  slug     String
  name     String
  products Product[]
  metadata CategoryMetadata[]

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model CategoryMetadata {
  id          String          @id @default(uuid())
  name        String
  category_id String
  category    Category        @relation(fields: [category_id], references: [id])
  values      MetadataValue[]

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model MetadataValue {
  id                   String           @id @default(uuid())
  label                String
  category_metadata_id String
  category_metadata    CategoryMetadata @relation(fields: [category_metadata_id], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model Order {
  id                  String         @id @default(uuid())
  status              String         @default("pending")
  total               Decimal        @db.Decimal(10, 2)
  shipping_cost       Decimal        @default(0) @db.Decimal(10, 2) // valor do frete
  shipping_days       Int            @default(0) // dias para entrega
  shipping_zipcode    String?
  shipping_street     String?
  shipping_number     String?
  shipping_city       String?
  shipping_state      String?
  shipping_contry     String?
  shipping_complement String?
  user_id             String
  user                User           @relation(fields: [user_id], references: [id])
  order_items         OrderProduct[]

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model OrderProduct {
  id         String   @id @default(uuid())
  quantity   Int      @default(1)
  price      Decimal  @db.Decimal(10, 2)
  order_id   String?
  order      Order?   @relation(fields: [order_id], references: [id])
  product_id String?
  product    Product? @relation(fields: [product_id], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}
